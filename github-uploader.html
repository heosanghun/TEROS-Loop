<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub í´ë” ì—…ë¡œë” - TEROS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .config-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .config-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .help-text {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .help-text a {
            color: #667eea;
            text-decoration: none;
        }

        .help-text a:hover {
            text-decoration: underline;
        }

        .drop-zone {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .drop-zone.drag-over {
            background: #e8ebff;
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .drop-zone-icon {
            font-size: 64px;
            margin-bottom: 20px;
            color: #667eea;
        }

        .drop-zone-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .drop-zone-hint {
            font-size: 14px;
            color: #888;
        }

        #fileInput {
            display: none;
        }

        .file-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            background: #f8f9fa;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .file-path {
            color: #555;
            word-break: break-all;
        }

        .file-size {
            color: #888;
            font-size: 12px;
            margin-left: 10px;
        }

        .remove-file {
            background: #ff4757;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .remove-file:hover {
            background: #ff3838;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-container {
            margin-top: 20px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .progress-text {
            text-align: center;
            color: #555;
            font-size: 14px;
        }

        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .folder-structure {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #555;
        }

        .folder-item {
            padding: 2px 0;
        }

        .folder-item.directory {
            color: #667eea;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ GitHub í´ë” ì—…ë¡œë”</h1>
        <p class="subtitle">ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ í´ë”ë¥¼ GitHub ì €ì¥ì†Œì— ì—…ë¡œë“œí•˜ì„¸ìš”</p>

        <div class="config-section">
            <h2>âš™ï¸ GitHub ì„¤ì •</h2>
            <div class="form-group">
                <label for="token">GitHub Personal Access Token *</label>
                <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxx">
                <div class="help-text">
                    <a href="https://github.com/settings/tokens" target="_blank">í† í° ìƒì„±í•˜ê¸°</a> - 
                    <strong>repo</strong> ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤
                </div>
            </div>
            <div class="form-group">
                <label for="username">GitHub ì‚¬ìš©ìëª… *</label>
                <input type="text" id="username" placeholder="your-username">
            </div>
            <div class="form-group">
                <label for="repo">ì €ì¥ì†Œ ì´ë¦„ *</label>
                <input type="text" id="repo" placeholder="teros-project">
                <div class="help-text">ì €ì¥ì†Œê°€ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤</div>
            </div>
            <div class="form-group">
                <label for="branch">ë¸Œëœì¹˜ ì´ë¦„</label>
                <input type="text" id="branch" value="main" placeholder="main">
            </div>
            <div class="form-group">
                <label for="path">ì—…ë¡œë“œ ê²½ë¡œ</label>
                <input type="text" id="path" placeholder="(ë£¨íŠ¸: ë¹„ì›Œë‘ê¸°, ì˜ˆ: docs/)">
                <div class="help-text">ì €ì¥ì†Œ ë‚´ íŠ¹ì • ê²½ë¡œì— ì—…ë¡œë“œí•˜ë ¤ë©´ ê²½ë¡œë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
            </div>
        </div>

        <div class="drop-zone" id="dropZone">
            <div class="drop-zone-icon">ğŸ“</div>
            <div class="drop-zone-text">í´ë”ë¥¼ ì—¬ê¸°ì— ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ì„¸ìš”</div>
            <div class="drop-zone-hint">ë˜ëŠ” í´ë¦­í•˜ì—¬ í´ë” ì„ íƒ</div>
            <input type="file" id="fileInput" webkitdirectory directory multiple>
        </div>

        <div id="fileList" class="file-list"></div>

        <div class="button-group">
            <button class="btn-secondary" id="clearBtn">ì´ˆê¸°í™”</button>
            <button class="btn-primary" id="uploadBtn" disabled>ì—…ë¡œë“œ ì‹œì‘</button>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="progress-text" id="progressText">ì¤€ë¹„ ì¤‘...</div>
        </div>

        <div class="status-message" id="statusMessage"></div>
    </div>

    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const uploadBtn = document.getElementById('uploadBtn');
        const clearBtn = document.getElementById('clearBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const statusMessage = document.getElementById('statusMessage');

        let files = [];
        let fileMap = new Map();

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('dragleave', handleDragLeave);
        dropZone.addEventListener('drop', handleDrop);

        fileInput.addEventListener('change', handleFileSelect);

        function handleDragOver(e) {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            
            const items = e.dataTransfer.items;
            if (items && items.length > 0 && items[0].webkitGetAsEntry) {
                handleDirectoryEntry(items[0].webkitGetAsEntry());
            }
        }

        function handleFileSelect(e) {
            const selectedFiles = Array.from(e.target.files);
            processFiles(selectedFiles);
        }

        function handleDirectoryEntry(entry) {
            if (entry.isDirectory) {
                const reader = entry.createReader();
                const entries = [];

                function readEntries() {
                    reader.readEntries((results) => {
                        if (results.length === 0) {
                            processEntries(entries);
                        } else {
                            entries.push(...results);
                            readEntries();
                        }
                    });
                }

                readEntries();
            } else if (entry.isFile) {
                entry.file((file) => {
                    fileMap.set(file.webkitRelativePath || file.name, file);
                    updateFileList();
                });
            }
        }

        function processEntries(entries) {
            entries.forEach(entry => {
                if (entry.isFile) {
                    entry.file((file) => {
                        const path = entry.fullPath.substring(1); // Remove leading /
                        file.webkitRelativePath = path;
                        fileMap.set(path, file);
                        updateFileList();
                    });
                }
            });
        }

        function processFiles(selectedFiles) {
            selectedFiles.forEach(file => {
                if (file.webkitRelativePath) {
                    fileMap.set(file.webkitRelativePath, file);
                } else {
                    fileMap.set(file.name, file);
                }
            });
            updateFileList();
        }

        function updateFileList() {
            fileList.innerHTML = '';
            files = Array.from(fileMap.values());
            
            if (files.length === 0) {
                uploadBtn.disabled = true;
                return;
            }

            uploadBtn.disabled = false;

            // í´ë” êµ¬ì¡° í‘œì‹œ
            const folderStructure = document.createElement('div');
            folderStructure.className = 'folder-structure';
            folderStructure.innerHTML = '<strong>ğŸ“‚ í´ë” êµ¬ì¡°:</strong><br>';

            const paths = Array.from(fileMap.keys()).sort();
            const tree = {};

            paths.forEach(path => {
                const parts = path.split('/');
                let current = tree;
                parts.forEach((part, index) => {
                    if (!current[part]) {
                        current[part] = index === parts.length - 1 ? 'FILE' : {};
                    }
                    current = current[part] === 'FILE' ? tree : current[part];
                });
            });

            function renderTree(obj, prefix = '', isLast = true) {
                const entries = Object.entries(obj);
                entries.forEach(([name, value], index) => {
                    const isLastEntry = index === entries.length - 1;
                    const connector = isLast ? 'â””â”€â”€ ' : 'â”œâ”€â”€ ';
                    const newPrefix = isLast ? prefix + '    ' : prefix + 'â”‚   ';
                    
                    if (value === 'FILE') {
                        folderStructure.innerHTML += `<div class="folder-item">${prefix}${connector}${name}</div>`;
                    } else {
                        folderStructure.innerHTML += `<div class="folder-item directory">${prefix}${connector}${name}/</div>`;
                        renderTree(value, newPrefix, isLastEntry);
                    }
                });
            }

            renderTree(tree);
            fileList.appendChild(folderStructure);

            // íŒŒì¼ ëª©ë¡ í‘œì‹œ
            const fileCount = document.createElement('div');
            fileCount.style.marginTop = '10px';
            fileCount.style.padding = '10px';
            fileCount.style.background = '#e8f5e9';
            fileCount.style.borderRadius = '5px';
            fileCount.style.fontSize = '14px';
            fileCount.style.color = '#2e7d32';
            fileCount.innerHTML = `âœ… ì´ <strong>${files.length}ê°œ</strong> íŒŒì¼ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤`;
            fileList.appendChild(fileCount);
        }

        clearBtn.addEventListener('click', () => {
            files = [];
            fileMap.clear();
            fileInput.value = '';
            updateFileList();
            hideStatus();
            hideProgress();
        });

        uploadBtn.addEventListener('click', async () => {
            const token = document.getElementById('token').value.trim();
            const username = document.getElementById('username').value.trim();
            const repo = document.getElementById('repo').value.trim();
            const branch = document.getElementById('branch').value.trim() || 'main';
            const path = document.getElementById('path').value.trim();

            if (!token || !username || !repo) {
                showStatus('GitHub ì„¤ì •ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            if (files.length === 0) {
                showStatus('ì—…ë¡œë“œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            await uploadFiles(token, username, repo, branch, path);
        });

        async function uploadFiles(token, username, repo, branch, basePath) {
            try {
                showProgress();
                showStatus('ì—…ë¡œë“œ ì¤€ë¹„ ì¤‘...', 'info');

                // ì €ì¥ì†Œ ì¡´ì¬ í™•ì¸ ë° ìƒì„±
                const repoExists = await checkRepository(token, username, repo);
                if (!repoExists) {
                    await createRepository(token, username, repo);
                    showStatus('ìƒˆ ì €ì¥ì†Œë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤.', 'info');
                }

                // ë¸Œëœì¹˜ í™•ì¸ ë° ìƒì„±
                await ensureBranch(token, username, repo, branch);

                // íŒŒì¼ ì—…ë¡œë“œ
                const totalFiles = files.length;
                let uploaded = 0;
                let failed = 0;

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const filePath = file.webkitRelativePath || file.name;
                    const uploadPath = basePath ? `${basePath}/${filePath}` : filePath;

                    try {
                        await uploadFile(token, username, repo, branch, uploadPath, file);
                        uploaded++;
                        updateProgress((uploaded / totalFiles) * 100, `${uploaded}/${totalFiles} ì—…ë¡œë“œ ì™„ë£Œ`);
                    } catch (error) {
                        failed++;
                        console.error(`Failed to upload ${filePath}:`, error);
                    }
                }

                hideProgress();
                if (failed === 0) {
                    showStatus(
                        `âœ… ì„±ê³µ! ${uploaded}ê°œ íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                        <a href="https://github.com/${username}/${repo}" target="_blank" style="color: #667eea;">
                            GitHubì—ì„œ í™•ì¸í•˜ê¸° â†’
                        </a>`,
                        'success'
                    );
                } else {
                    showStatus(
                        `âš ï¸ ë¶€ë¶„ ì™„ë£Œ: ${uploaded}ê°œ ì„±ê³µ, ${failed}ê°œ ì‹¤íŒ¨`,
                        'error'
                    );
                }
            } catch (error) {
                hideProgress();
                showStatus(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                console.error('Upload error:', error);
            }
        }

        async function checkRepository(token, username, repo) {
            try {
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                return response.ok;
            } catch {
                return false;
            }
        }

        async function createRepository(token, username, repo) {
            const response = await fetch('https://api.github.com/user/repos', {
                method: 'POST',
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: repo,
                    private: false,
                    auto_init: true
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'ì €ì¥ì†Œ ìƒì„± ì‹¤íŒ¨');
            }

            // ì €ì¥ì†Œ ìƒì„± í›„ ë¸Œëœì¹˜ê°€ ìƒì„±ë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¼
            await new Promise(resolve => setTimeout(resolve, 2000));
        }

        async function ensureBranch(token, username, repo, branch) {
            try {
                // ë¸Œëœì¹˜ ì¡´ì¬ í™•ì¸
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}/branches/${branch}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    return; // ë¸Œëœì¹˜ê°€ ì´ë¯¸ ì¡´ì¬í•¨
                }

                // ë©”ì¸ ë¸Œëœì¹˜ ê°€ì ¸ì˜¤ê¸°
                const defaultBranchResponse = await fetch(`https://api.github.com/repos/${username}/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                const repoData = await defaultBranchResponse.json();
                const defaultBranch = repoData.default_branch || 'main';

                // ìƒˆ ë¸Œëœì¹˜ ìƒì„±
                const shaResponse = await fetch(`https://api.github.com/repos/${username}/${repo}/git/refs/heads/${defaultBranch}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                const shaData = await shaResponse.json();

                await fetch(`https://api.github.com/repos/${username}/${repo}/git/refs`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ref: `refs/heads/${branch}`,
                        sha: shaData.object.sha
                    })
                });
            } catch (error) {
                console.warn('Branch creation skipped:', error);
            }
        }

        async function uploadFile(token, username, repo, branch, path, file) {
            // íŒŒì¼ì„ Base64ë¡œ ì¸ì½”ë”©
            const content = await readFileAsBase64(file);

            // íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
            let sha = null;
            try {
                const getResponse = await fetch(
                    `https://api.github.com/repos/${username}/${repo}/contents/${encodeURIComponent(path)}?ref=${branch}`,
                    {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                if (getResponse.ok) {
                    const data = await getResponse.json();
                    sha = data.sha;
                }
            } catch (error) {
                // íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
            }

            // íŒŒì¼ ì—…ë¡œë“œ ë˜ëŠ” ì—…ë°ì´íŠ¸
            const response = await fetch(
                `https://api.github.com/repos/${username}/${repo}/contents/${encodeURIComponent(path)}`,
                {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Upload ${path}`,
                        content: content,
                        branch: branch,
                        sha: sha
                    })
                }
            );

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨');
            }
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function showProgress() {
            progressContainer.style.display = 'block';
            updateProgress(0, 'ì¤€ë¹„ ì¤‘...');
        }

        function hideProgress() {
            progressContainer.style.display = 'none';
        }

        function updateProgress(percent, text) {
            progressFill.style.width = `${percent}%`;
            progressFill.textContent = `${Math.round(percent)}%`;
            progressText.textContent = text;
        }

        function showStatus(message, type) {
            statusMessage.className = `status-message ${type}`;
            statusMessage.innerHTML = message;
            statusMessage.style.display = 'block';
        }

        function hideStatus() {
            statusMessage.style.display = 'none';
        }
    </script>
</body>
</html>

